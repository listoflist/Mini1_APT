{% extends "base.html" %}
{% block content %}

<div class="container_16">
    <article class="grid_16">
        <div class="item rounded dark">
            <div id="map_canvas" class="map"></div>
        </div>
    </article>
</div>

<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>
<script type="text/javascript" src="js/jquery-1.7.1/jquery.min.js"></script>
<!--  <script type="text/javascript" src="js/underscore-1.2.2/underscore.min.js"></script>
<script type="text/javascript" src="js/backbone-0.5.3/backbone.min.js"></script>
<script type="text/javascript" src="js/prettify/prettify.min.js"></script>-->
<script type="text/javascript" src="js/demo.js"></script>
<script type="text/javascript" src="js/markerclustererplus-2.0.6/markerclusterer.min.js"></script>
<script type="text/javascript" src="ui/jquery.ui.map.js"></script>
<script type="text/javascript">
    $(function() {
        demo.add(function() {
            $('#map_canvas').gmap({'zoom': 2, 'disableDefaultUI':true}).bind('init', function(evt, map) {
                var bounds = map.getBounds();
                var southWest = bounds.getSouthWest();
                var northEast = bounds.getNorthEast();
                var lngSpan = northEast.lng() - southWest.lng();
                var latSpan = northEast.lat() - southWest.lat();

                {% for info in infos%}
                    $(this).gmap('addMarker', { 'position': new google.maps.LatLng(southWest.lat() + latSpan * Math.random(), southWest.lng() + lngSpan * Math.random()) } ).click(function() {
                        $('#map_canvas').gmap('openInfoWindow', { content : '<IMG height="100" width="100" src="img?img_id={{ info[0] }}">' }, this);
                    });
                {% endfor%}

                $(this).gmap('set', 'MarkerClusterer', new MarkerClusterer(map, $(this).gmap('get', 'markers')));
            });
        }).load();
    });
</script>


{% endblock %}
