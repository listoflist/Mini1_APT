{% extends "base.html" %}
{% block content %}
<h2 >{{stream_name}}</h2>
<table border="1" style="width:100%">
    <tr>
        {% for picture in pictures%}
            <td><img src="img?img_id={{picture.key()}}"></td>
        {% endfor%}
    </tr>
</table>
<form action="{{showmoreurl}}" ,method="post"><input type="submit" value="More Pictures"></form>
<form action="{{geoviewurl}}" ,method="post"><input type="submit" value="Geo View"></form>

{% if (status == (1,1))%}
<form action="{{uploadurl}}" method="post" class = "dropzone" enctype="multipart/form-data">
    Upload File: <input type="file"  name="files[]" multiple/><br>
    <input type="submit" name="submit" value="Submit">
</form>
{% else %}
<form action="subscribe" method="post"><input type="submit" value="Subscribe"></form>
{%endif%}


<div class="container_16">
    <article class="grid_16">
        <div class="item rounded dark">
            <div id="map_canvas" class="map"></div>
        </div>
    </article>
</div>

<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>
<script type="text/javascript" src="js/jquery-1.7.1/jquery.min.js"></script>
<!--  <script type="text/javascript" src="js/underscore-1.2.2/underscore.min.js"></script>
<script type="text/javascript" src="js/backbone-0.5.3/backbone.min.js"></script>
<script type="text/javascript" src="js/prettify/prettify.min.js"></script>-->
<script type="text/javascript" src="js/demo.js"></script>
<script type="text/javascript" src="js/markerclustererplus-2.0.6/markerclusterer.min.js"></script>
<script type="text/javascript" src="ui/jquery.ui.map.js"></script>
<script type="text/javascript">
    $(function() {
        demo.add(function() {
            $('#map_canvas').gmap({'zoom': 2, 'disableDefaultUI':true}).bind('init', function(evt, map) {
                var bounds = map.getBounds();
                var southWest = bounds.getSouthWest();
                var northEast = bounds.getNorthEast();
                var lngSpan = northEast.lng() - southWest.lng();
                var latSpan = northEast.lat() - southWest.lat();
                var pic0key = "{{ pictures[0].key() }}";
                console.log(pic0key);

                {% for picture in pictures%}
                    $(this).gmap('addMarker', { 'position': new google.maps.LatLng(southWest.lat() + latSpan * Math.random(), southWest.lng() + lngSpan * Math.random()) } ).click(function() {
                        $('#map_canvas').gmap('openInfoWindow', { content : '<IMG height="100" width="100" src="img?img_id={{ picture.key() }}">' }, this);
                    });
                {% endfor%}

                $(this).gmap('set', 'MarkerClusterer', new MarkerClusterer(map, $(this).gmap('get', 'markers')));
            });
        }).load();
    });
</script>

{% endblock %}
